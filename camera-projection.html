<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hello, World! - A-Frame</title>
    <meta name="description" content="Hello, World! - A-Frame">
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g=" crossorigin="anonymous"></script>
</head>

<body>
    <a-scene id="scene">
        <a-assets>
            <a-asset-item id="ground-obj" src="models/ground.obj"></a-asset-item>
            <a-asset-item id="ground-mtl" src="models/ground.mtl"></a-asset-item>
            <a-asset-item id="person-obj" src="models/person.obj"></a-asset-item>
            <a-asset-item id="person-mtl" src="models/person.mtl"></a-asset-item>
        </a-assets>
        <a-light type="ambient" intensity="7" color="#ed8080"></a-light>
        <a-light type="directional" intensity=".05" color="#edae59" position="1 5 0"></a-light>
        <a-light type="directional" intensity=".1" color="#387a78" position="-1 5 0"></a-light>
        <a-light type="directional" intensity=".1" color="#387a78" position="1 5 4"></a-light>
        <a-light type="directional" intensity=".05" color="#edae59" position="-1 5 4"></a-light>
        <a-sky src="images/ocean.jpg"></a-sky>
        <a-obj-model src="#ground-obj" mtl="#ground-mtl" position="-1 1 12"></a-obj-model>
        <a-obj-model src="#ground-obj" mtl="#ground-mtl" position="-1 1 4"></a-obj-model>
        <a-obj-model src="#ground-obj" mtl="#ground-mtl" position="-1 1 -4"></a-obj-model>
        <a-obj-model src="#ground-obj" mtl="#ground-mtl" position="-1 1 -12"></a-obj-model>
        <a-obj-model src="#ground-obj" mtl="#ground-mtl" position="-1 1 -16"></a-obj-model>
        <a-entity id="moving-box">
           <a-animation attribute="position" dur="9000" easing="linear" repeat="indefinite" to="0 0 -9"></a-animation>
          <a-entity id="person" obj-model="obj: #person-obj; mtl: #person-mtl" scale=".1 .1 .1" position="0 1.7 -1"></a-entity>
          <a-entity id="active-camera" position="0 0.5 0.5">
              <a-camera></a-camera>
          </a-entity>
           <!-- <a-entity id="active-camera" camera position="0 0.1 1" look-controls></a-entity> -->
        </a-entity>
        
    </a-scene>
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-database.js"></script>
    <script src="Bot.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyD8B8P-Bejr47q3FzLG7KO3EF-CvHp6028",
        authDomain: "bot-a-razzi.firebaseapp.com",
        databaseURL: "https://bot-a-razzi.firebaseio.com",
        projectId: "bot-a-razzi",
        storageBucket: "",
        messagingSenderId: "24375466887"
    };
    firebase.initializeApp(config);
    var database = firebase.database();
    var numbots = 0;
    database.ref('info/numbots').on('value', function(snapshot) {
        numbots = snapshot.val();
    });
    var botarr = [];
    var updatebot = function(i) {
        database.ref('bots/' + "bot" + i).on('value', function(snapshot) {
            //console.log(i);
            var bot = botarr[i];
            console.log(bot, snapshot.val().x);
            bot.move(snapshot.val().x, snapshot.val().y, snapshot.val().z);

        });
    }
    database.ref('info/botsinitialized').on('value', function(snapshot) {
        console.log("reinitialize", numbots);
        $(".bot").remove();
        botarr = [];
        for (var i = 0; i < numbots; i++) {
            botarr.push(new Bot(i));
        }

        for (var i = 0; i < numbots; i++) {
            updatebot(i);
        }

    });
     database.ref('info/activecamera').on('value', function(snapshot) {
        console.log("CHANGE CAMERA");
        var bot = document.getElementById(snapshot.val());

        var pos = bot.getAttribute('position');
        var cam = document.getElementById("active-camera");
        console.log(cam);
        cam.setAttribute("position", {x: pos.x * 0.3, y: pos.y * 0.3, z:pos.z * 0.3});

    });
    </script>
</body>

</html>